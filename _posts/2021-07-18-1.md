---
title: Accidental second order error based sql injection
tags: sql
author: djxploit
show_author_profile: true
show_title: true
show_date: true
show_tags: true
full_width: false
header: false
footer: true
show_edit_on_github: false
show_subscribe: false
license: false
---

Hello everyone. 
So this issue was found on a program x. I was originally looking for second order xss, but inserting a single `double_quote(")` gave me a sql error (invalid syntax).
The original request is a POST based request, that was used for creating the campaign. Upon submitting the request, the request will generate a link for the
campaign , and you can access it. The POST data contain a field `campaign_name` , and that was the injection point. As this name was getting reflected in the
source code of the generated campaign, so I tried to see which characters are encoded. And in that process, I inserted a single `double_quote(")`, and upon visting
the generated link, gave me a sql error. To confirm, I add another `double_quote(")` and the error was gone, and I received a 200 OK response status (On error it
was giving me 500 status with the sql error). So this confimed that it is an error-based sql injection. From the error message , I also found the structure of the
sql query :
```select name from campaign where name like "entered campaign name%"```
So my injection was in `entered campaign name`. So it is evident, a single double quote would break the query, but 2 double quote won't break the query. Also I found
that to remove or discard the remaining `%"` of the query, I could use comment , after my injected query. Upon trial and error , found that `#` is working as a valid
comment. So my injected query is like :
```select name from campaign where name like "entered campaign name"injection;#%"```
The semicolon is used to end the statements that are being used in the injection.

My next option was to extract data. First I tried to check what keywords are allowed. This is because, when I tried to add `and` or `or` keyword, it was blocked by
cloudflare WAF, giving me a 403 status code. So then I checked for `UNION`, luckily this was allowed. Similarly `ORDER by` was also allowed. But white spaces are
not allowed. So I tried various bypassses, and settled on sql inline comments `/**/`. So now I could use `UNION` to execute additional sql queries in the injected
point. So if I am going to use UNION, one thing to remeber is that the number of columns, the previous table has, should be equal to number of columns you are
accessing in your query. So if `campaign_name` table has 3 columns ,then we should also use 3 columns. So we could inject additional query as follows: 
```select name from campaign where name like "entered campaign name" UNION select 1,2,3;#%"```
But as we don't know the column number of the `campaign` table, we need to find that using the `ORDER BY` clause as follows :
```select name from campaign where name like "entered campaign" ORDER BY 1;#```
If this returned no error, then we need to increase the `ORDER BY` number, unless we get an error. So for example, if `ORDER BY 5` gives and error, but `ORDER BY 4`
doesnot give an error, then we can conclude that the table `campaign` has 4 columns.
So now we could finally use the union statement. So I ran the follwoing query:
```select name from campaign where name like "entered campaign" UNION select 1,2,3,4;#```
This gave me 200 status error, meaning that the query executed without any error. So it is valid.
But the thing is none of the 1,2,3 or 4 is reflected in the response. So I could not
